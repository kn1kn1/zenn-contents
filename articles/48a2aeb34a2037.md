---
title: "sklearn-onnxã§ã€RandomForestClassifierã®å‡ºåŠ›ãŒboolã®ã¨ãã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ä»¶"
emoji: "ğŸ«§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["scikitlearn", "ONNX", "Python"]
published: true
---

# æ¦‚è¦

è¡¨è¨˜ã®ä»¶ã§ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å›é¿ã—ãŸã®ã§ã€ãã®å‚™å¿˜éŒ²ã€‚

# äº‹è±¡

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã€ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã®å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ONNXã«å¤‰æ›ã—ã‚ˆã†ã¨ã—ãŸã¨ã“ã‚ã€`AttributeError: 'numpy.bool_' object has no attribute 'encode'
` ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã€‚

```
from sklearn.ensemble import RandomForestClassifier

classifier = RandomForestClassifier(
    n_estimators = 5,
    random_state = 42,
    n_jobs = -1
)

features = ['Time', 'V1', 'V2', 'V3', 'V4', 'V5', 'V26', 'V27', 'V28', 'Amount']
x = raw_df[features]
y = raw_df['Class_bool']
classifier.fit(x, y)

x1 = x[:1]
onx = to_onnx(classifier, x1.to_numpy().astype(np.float32), target_opset=12)
```

https://gist.github.com/kn1kn1/133526aadf029f50fc5b97564aac29f0

# åŸå› ã¨å›é¿æ–¹æ³•

å‡ºåŠ›yã¨ã—ã¦è¨­å®šã—ã¦ã„ã‚‹dataframeã®ã‚«ãƒ©ãƒ ã®å‹ãŒboolã§ã€ã“ã‚ŒãŒsklearn-onnxã§å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸã®ãŒåŸå› ã§ã‚ã‚‹ã€‚

éå»ã«ã‚‚åˆ¥ãªconverterã§åŒã˜ã‚ˆã†ãªäº‹è±¡ãŒã‚ã£ãŸã‚ˆã†ã§ã€https://github.com/onnx/sklearn-onnx/issues/813 ã«å›é¿æ–¹æ³•ãŒã‚ã£ãŸã®ã§ãã‚Œã‚’å‚ç…§ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«int32å‹ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§å›é¿ã—ãŸã€‚

```
# apply a workaround described at https://github.com/onnx/sklearn-onnx/issues/813
classifier.classes_ = classifier.classes_.astype(np.int32)
onx = to_onnx(classifier, x1.to_numpy().astype(np.float32), target_opset=12)
```

# ä¸å…·åˆã®å ±å‘Šã¨æ”¹ä¿®

ä¸Šè¨˜ã«ã¤ã„ã¦ã€GitHubã®issueã§ä¸å…·åˆã®å ±å‘Šã‚’è¡Œã£ãŸã¨ã“ã‚ã€ç´ æ—©ãå¯¾å¿œã—ã¦é ‚ã‘ãŸã€‚æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ã§ã¯ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã¯ä¸è¦ã«ãªã‚‹ã ã‚ã†ã€‚

https://github.com/onnx/sklearn-onnx/issues/946

ä»Šå›ã®ä»¶ã¯ã€ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã¯ç¨€ã§ã€ä¸Šã®notebookã§ã‚‚äº‹è±¡ã‚’å†ç¾ã•ã›ã‚‹ãŸã‚ã«ã‚ã–ã‚ã–boolå‹ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€ã‚‚ã—ä»Šå¾Œboolä»¥å¤–ã®å‹ã§ã‚‚åŒã˜ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ãŒã‚ã‚Œã°åŒæ§˜ã®å¯¾å¿œã§å›é¿ã§ããã†ã§ã‚ã‚‹ã€‚
