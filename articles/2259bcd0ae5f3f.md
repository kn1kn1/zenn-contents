---
title: "Rã®æ—¥æ™‚ãƒ‡ãƒ¼ã‚¿ #1 - èº“ããƒã‚¤ãƒ³ãƒˆ2ã¤"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "r"
published: true
---

# ã¯ã˜ã‚ã«

ä»Šå›ã‹ã‚‰Rã®æ—¥æ™‚ãƒ‡ãƒ¼ã‚¿[^1]ã«ã¤ã„ã¦ä½•å›ã‹æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

[^1]: ã€Œæ—¥æ™‚ãƒ‡ãƒ¼ã‚¿ã€ã‚„ã€Œæ—¥æ™‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã„ã£ãŸç”¨èªã¯ã€é‡é–“å£è¬™å¤ªéƒ, èŠæ± æ³°æ¨¹ è¨³ ã€Œçµ±è¨ˆå­¦:Rã‚’ç”¨ã„ãŸå…¥é–€æ›¸ ç¬¬ï¼’ç‰ˆã€å…±ç«‹å‡ºç‰ˆ 2016 pp.348-349 ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

#1ã®ä»Šå›ã¯ã€Rã§æ—¥æ™‚ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã£ã¦ã„ã¦èº“ã„ãŸä»¥ä¸‹ã®2ç‚¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

1. å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Š`as.POSIXct`ã®çµæœãŒç•°ãªã‚‹
1. [ISO8601å½¢å¼](https://ja.wikipedia.org/wiki/ISO_8601)ã‚’ãƒ‘ãƒ¼ã‚¹ã§ããªã„

## 1. å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Š`as.POSIXct`ã®çµæœãŒç•°ãªã‚‹

ä»¥ä¸‹ã¯ã€POSIXctå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹å…¨ãåŒä¸€ã®ã‚³ãƒ¼ãƒ‰`as.POSIXct("2011-03-20 12:34:56")`ã‚’ã€ã„ãã¤ã‹ã®å®Ÿè¡Œç’°å¢ƒã§å®Ÿè¡Œã—ãŸã‚‚ã®ã§ã™ãŒã€çµæœãŒç•°ãªã£ã¦ã„ã¾ã™ã€‚

- ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ï¼ˆMacï¼‰ä¸Š

```
> as.POSIXct("2011-03-20 12:34:56")
[1] "2011-03-20 12:34:56 JST"
```

- Google Compute Engineã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆLinuxï¼‰ä¸Š
```
> as.POSIXct("2011-03-20 12:34:56")
[1] "2011-03-20 12:34:56 UTC"
```

- Google Colaboratoryä¸Š
```
%%R
as.POSIXct("2011-03-20 12:34:56")

[1] "2011-03-20 12:34:56 UTC"
```
https://gist.github.com/kn1kn1/5575547653d227fa1ee3051777012b15

ã“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒgitã«å…¥ã£ã¦ã„ã¦è¤‡æ•°äººã®ç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã¨ã€ç’°å¢ƒã«ã‚ˆã£ã¦çµæœãŒä¸€è‡´ã—ãªã„ã¨ã„ã†äº‹æ…‹ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚

### åŸå› 

åŸå› ã¯ã€å¼•æ•°`tz`ã‚’æŒ‡å®šã›ãš`as.POSIXct("2011-03-20 12:34:56")`ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚

ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ã€`Sys.timezone()`ã§èª¿ã¹ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä¸Šè¨˜ã®ãã‚Œãã‚Œã®ç’°å¢ƒã§ã€`Sys.timezone()`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€è¿”ã£ã¦ãã‚‹å€¤ãŒç•°ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

- ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ï¼ˆMacï¼‰ä¸Š

```
> Sys.timezone()
[1] "Asia/Tokyo"
```

- Google Compute Engineã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆLinuxï¼‰ä¸Š
```
> Sys.timezone()
[1] "Etc/UTC"
```

- Google Colaboratoryä¸Š
```
%%R
Sys.timezone()

[1] "Etc/UTC"
```

### å¯¾å¿œæ–¹æ³•

å¯¾å¿œã¨ã—ã¦ã¯ã€2ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

- `as.POSIXct`ã§`tz`å¼•æ•°ã‚’æŒ‡å®šã™ã‚‹
- `Sys.setenv`ã§ç’°å¢ƒå¤‰æ•°`TZ`ã‚’è¨­å®šã™ã‚‹

#### `as.POSIXct`ã§`tz`å¼•æ•°ã‚’æŒ‡å®šã™ã‚‹

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`tz`å¼•æ•°ã¨ã—ã¦`"Asia/Tokyo"`ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚Œã°ã€ã©ã®ç’°å¢ƒã§ã‚‚åŒã˜æ—¥æ™‚ã‚’å·®ã™POSIXctå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

```
> as.POSIXct("2011-03-20 12:34:56", tz="Asia/Tokyo")
[1] "2011-03-20 12:34:56 JST"
```

#### `Sys.setenv`ã§ç’°å¢ƒå¤‰æ•°`TZ`ã‚’è¨­å®šã™ã‚‹

`as.POSIXct`ã‚’å‘¼ã³å‡ºã™å‰ã«ã€`Sys.setenv`ã§ç’°å¢ƒå¤‰æ•°`TZ`ã‚’å¿…ãšè¨­å®šã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã®ãŒã€ã‚‚ã†ä¸€ã¤ã®æ–¹æ³•ã§ã™ã€‚ä½†ã—ã“ã‚Œã¯ã‚³ãƒ¼ãƒ‰ã®å†’é ­ã«æ›¸ããªã©å·¥å¤«ãŒå¿…è¦ãªã®ãŒé›£ç‚¹ã¨è¨€ãˆã¾ã™ã€‚

```
> Sys.timezone()
[1] "Asia/Tokyo"
> Sys.getenv('TZ')
[1] ""
> as.POSIXct("2011-03-20 12:34:56")
[1] "2011-03-20 12:34:56 JST"
> Sys.setenv(TZ='UTC')
> Sys.getenv('TZ')
[1] "UTC"
> as.POSIXct("2011-03-20 12:34:56")
[1] "2011-03-20 12:34:56 UTC"
> 
```

##### `timezones {base}` ãƒ˜ãƒ«ãƒ—ã®è¦‹è§£

timezones {base}ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚

> Time zones are a system-specific topic, 

ã¨ã—ãŸä¸Šã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ç’°å¢ƒå¤‰æ•°`TZ`ã«ã‚ˆã‚‹è¨­å®šã¯ã€Rã®ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹•å‰ã«ï¼ˆ`.Rprofile`ã«è¨˜è¿°ã™ã‚‹ãªã©ã§ï¼‰å®Ÿæ–½ã™ã‚‹ã¨ã€`Sys.timezone()`ã«åæ˜ ã•ã‚Œã‚‹ã¨ã—ã¦ã„ã¾ã™ãŒã€ã“ã®å¯¾å¿œã‚’å®Ÿæ–½ã—ãŸã¨ã“ã‚ã§ç’°å¢ƒä¾å­˜ã§ã‚ã‚‹ã“ã¨ã«å¤‰ã‚ã‚Šã¯ãªã„ã§ã—ã‚‡ã†ã€‚ã‚³ãƒ¼ãƒ‰ã®ã¿ã§ä¸€è‡´ã—ãŸçµæœã‚’å¾—ã‚‹ã«ã¯ã€ä¸Šã§ç´¹ä»‹ã—ãŸ2ã¤ã®å¯¾å¿œæ–¹æ³•ãŒè‰¯ã•ãã†ã§ã™ã€‚

> It should be possible to set the current time zone via the environment variable TZ: see the section on â€˜Time zone namesâ€™ for suitable values. Sys.timezone() will return the value of TZ if set initially (and on some OSes it is always set), otherwise it will try to retrieve from the OS a value which if set for TZ would give the initial time zone. (â€˜Initiallyâ€™ means before any time-zone functions are used: if TZ is being set to override the OS setting or if the â€˜tryâ€™ does not get this right, it should be set before the R process is started or (probably early enough) in file .Rprofile).


## 2. [ISO8601å½¢å¼](https://ja.wikipedia.org/wiki/ISO_8601)ã‚’ãƒ‘ãƒ¼ã‚¹ã§ããªã„

baseãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«[ISO8601å½¢å¼](https://ja.wikipedia.org/wiki/ISO_8601)ï¼ˆã‚ˆãä½¿ã‚ã‚Œã‚‹`2022-11-24T00:30:38+09:00`ã®ã‚ˆã†ãª[æ‹¡å¼µå½¢å¼](https://ja.wikipedia.org/wiki/ISO_8601#%E5%9F%BA%E6%9C%AC%E5%BD%A2%E5%BC%8F%E3%81%A8%E6%8B%A1%E5%BC%B5%E5%BD%A2%E5%BC%8F)ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ï¼‰ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹é–¢æ•°ãŒå­˜åœ¨ã—ãªã„ã‚ˆã†ã§ã—ãŸã€‚`POSIXct`ã¯ãã®åã®ã¨ãŠã‚Šã€POSIXæ™‚é–“ã‚’å¯¾è±¡ã¨ã—ãŸå‹ã§ã‚ã‚Šã€ISO8601ã«ã¯å¯¾å¿œã—ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚

```
> as.POSIXct("2022-11-24T00:30:38+09:00")
[1] "2022-11-24 JST"
```

ISO8601å½¢å¼ã®æ–‡å­—åˆ—ã‚’`as.POSIXct`é–¢æ•°ã§ãƒ‘ãƒ¼ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€`T`åŒºåˆ‡ã‚Šè¨˜å·ï¼ˆtimeã‚’è¡¨ã™ cf. https://en.wikipedia.org/wiki/ISO_8601#Times ï¼‰ã‚’è§£é‡ˆã§ããšã€å¹´æœˆæ—¥ã¾ã§ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã£ã¦ã„ã¾ã—ãŸã€‚


### å¯¾å¿œæ–¹æ³•

`lubridate`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€`ymd_hms`é–¢æ•°ã‚’ä½¿ã†ã¨è§£æ±ºã§ãã¾ã™ã€‚

```
> lubridate::ymd_hms("2022-11-24T00:30:38+09:00")
[1] "2022-11-23 15:30:38 UTC"
> 
```

https://lubridate.tidyverse.org/

`lubridate`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€ä»–ã«ã‚‚

- [with_tz](https://lubridate.tidyverse.org/reference/with_tz.html)
- [force_tz](https://lubridate.tidyverse.org/reference/force_tz.html)

ã‚’ã¯ã˜ã‚ã¨ã—ã¦ä¾¿åˆ©ãªé–¢æ•°ãŒã‚ã‚‹ã®ã§ã€ä¸€é€šã‚Šãƒã‚§ãƒƒã‚¯ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚


# ã¾ã¨ã‚

ä»¥ä¸Šã€Rã®æ—¥æ™‚ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ç§è‡ªèº«ãŒç‰¹ã«åµŒã£ãŸãƒã‚¤ãƒ³ãƒˆ2ã¤ã§ã—ãŸã€‚

æ¬¡å›ã®#2ã¯ã€ä»Šå›ç´¹ä»‹ã—ãŸæ‰‹é †ã‚‚å«ã‚ãŸæ–‡å­—åˆ—â‡”æ—¥æ™‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›ã«ã¤ã„ã¦ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒ

- https://oku.edu.mie-u.ac.jp/~okumura/stat/timeseries.html
- http://www.okadajp.org/RWiki/?%E6%97%A5%E4%BB%98%E3%80%81%E6%99%82%E9%96%93%E9%96%A2%E6%95%B0Tips%E5%A4%A7%E5%85%A8
- https://lubridate.tidyverse.org/
- https://ja.wikipedia.org/wiki/ISO_8601
